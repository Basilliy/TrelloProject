/**
 * ngScrollable - Superamazing scrollbars for AngularJS
 * @version 0.2.3 - built on 2015-12-11
 * @link https://echa.github.io/ng-scrollable/
 * @license MIT License, Copyright (c) 2015 Alexander Eichhorn <alex@kidtsunami.com>
 */
angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(a){"use strict";var b=a.get("$document"),c=a.get("$interval"),d=a.get("$timeout"),e=a.get("$window"),f=a.get("$parse"),g=angular.bind,h=angular.extend,i=angular.element,j=(angular.isDefined,"undefined"!=typeof e.ontouchstart),k="transform",l=e.requestAnimationFrame||e.webkitRequestAnimationFrame,m=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;["webkit","moz","o","ms"].every(function(a){var c=a+"Transform",d=b.find("body").eq(0);return"undefined"!=typeof d[0].style[c]?(k=c,!1):!0});var n={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,useObserver:!0,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,preventKeyEvents:!0,updateOnResize:!0,kineticTau:325,spyMargin:1};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,o,p){var q,r,s,t,u,v=h({},n,a.$eval(p.ngScrollable)),w=i(o.children()[0]),x={window:i(e),el:w,content:i(w.children()[0]),barX:i(w.children()[1]),barY:i(w.children()[2]),sliderX:i(i(w.children()[1]).children()[0]),sliderY:i(i(w.children()[2]).children()[0])},y=!1,z=!1,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=null,L=null,M=null,N=null,O=!1,P=!1,Q=!1,R={},S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=function(a){return a.toFixed(3)+"px"},_=function(a,b,c){return Math.max(b,Math.min(a,c))},aa=function(){var b=a.$root?a.$root.$$phase:a.$$phase;"$apply"!==b&&"$digest"!==b&&a.$digest()},ba=function(){var a=A-3;y?(G=Math.max(v.minSliderLength,parseInt(a*a/C,10)),H=parseInt(F*(a-G)/(C-a),10),H>=a-G?H=a-G:0>H&&(H=0),x.sliderX[0].style[k]="translate3d("+$(H)+",0,0)",x.sliderX[0].style.width=$(G)):(G=H=0,x.sliderX[0].style[k]="translate3d(0,0,0)",x.sliderX[0].style.width="0")},ca=function(){var a=B-3;z?(I=Math.max(v.minSliderLength,parseInt(a*a/D,10)),J=parseInt(E*(a-I)/(D-a),10),J>=a-I?J=a-I:0>J&&(J=0),x.sliderY[0].style[k]="translate3d(0,"+$(J)+",0)",x.sliderY[0].style.height=$(I)):(J=I=0,x.sliderY[0].style[k]="translate3d(0,0,0)",x.sliderY[0].style.height="0")},da=function(){var a=v.scrollXAlways,b={left:0,width:$(A),display:y||a?"inherit":"none"};switch(v.scrollX){case"bottom":b.bottom=0,x.content[y||a?"addClass":"removeClass"]("scrollable-bottom"),x.barX[y||a?"addClass":"removeClass"]("scrollable-bottom");break;case"top":b.top=0,x.content[y||a?"addClass":"removeClass"]("scrollable-top"),x.barX[y||a?"addClass":"removeClass"]("scrollable-top")}x.barX.css(b),x.sliderX[0].style.display=y?"inherit":"none"},ea=function(){var a=v.scrollYAlways,b={top:0,height:$(B),display:z||a?"inherit":"none"};switch(v.scrollY){case"right":b.right=0,x.content[z||a?"addClass":"removeClass"]("scrollable-right"),x.barY[z||a?"addClass":"removeClass"]("scrollable-right");break;case"left":b.left=0,x.content[z||a?"addClass":"removeClass"]("scrollable-left"),x.barY[z||a?"addClass":"removeClass"]("scrollable-left")}x.barY.css(b),x.sliderY[0].style.display=z?"inherit":"none"},fa=function(){var b=!1;R.spyX&&(R.spyX(a,parseInt(F,10)),b=!0),R.spyY&&(R.spyY(a,parseInt(E,10)),b=!0),b&&aa()},ga=function(b,c){var d=E,e=F;E=_(c,0,D-B),F=_(b,0,C-A),x.content[0].style[k]="translate3d("+$(-F)+","+$(-E)+",0)",a.$applyAsync(fa),B*v.spyMargin>E&&d>=B*v.spyMargin&&a.$broadcast("scrollable.spytop",E,v.id),E>D-B*(v.spyMargin+1)&&D-B*(v.spyMargin+1)>=d&&a.$broadcast("scrollable.spybottom",E,v.id),A*v.spyMargin>F&&e>=A*v.spyMargin&&a.$broadcast("scrollable.spyleft",F,v.id),F>C-A*(v.spyMargin+1)&&C-A*(v.spyMargin+1)>=e&&a.$broadcast("scrollable.spyright",F,v.id)},ha=function(a){y&&(ga(a,E),ba())},ia=function(a){z&&(ga(F,a),ca())},ja=function(b,c){A=v.usePadding?x.el[0].clientWidth:x.el[0].offsetWidth,B=v.usePadding?x.el[0].clientHeight:x.el[0].offsetHeight,C=x.content[0].scrollWidth,D=x.content[0].scrollHeight,"none"!==v.scrollX&&C>A+v.scrollXSlackSpace?y=!0:(ha(0),y=!1),"none"!==v.scrollY&&D>B+v.scrollYSlackSpace?z=!0:(ia(0),z=!1),da(),ea(),ba(),ca(),F+H+G>C&&ha(H),E+J+I>D&&ia(J),c||a.$broadcast("scrollable.dimensions",A,B,C,D,v.id)},ka=function(a,b){return a.stopPropagation(),b&&a.preventDefault(),!1},la=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageY:a.pageY},ma=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageX:a.pageX},na=function(){var a,b,c,d;a=Date.now(),b=a-t,t=a,c=F-U,U=F,d=1e3*c/(1+b),S=.8*d+.2*S,c=E-Y,Y=E,d=1e3*c/(1+b),W=.8*d+.2*W},oa=function(){var a,b;T&&(a=Date.now()-t,b=-T*Math.exp(-a/v.kineticTau),b>.5||-.5>b?(ha(V+b),l(oa)):ha(V))},pa=function(){var a,b;X&&(a=Date.now()-t,b=-X*Math.exp(-a/v.kineticTau),b>.5||-.5>b?(ia(Z+b),l(pa)):ia(Z))},qa=function(a){return L=ma(a),K=F,O=!0,S=T=0,U=F,j||(b.on("mousemove",ra),b.on("mouseup",sa)),j&&!u&&(u=c(na,100)),x.el.addClass("active"),j||ka(a,!0)},ra=function(a){if(O){var b=ma(a)-L,c=j?-b:parseInt(b*(C-A)/(A-G),10);return l(g(null,ha,K+c)),j||ka(a,!0)}},sa=function(a){return O&&(j||(b.off("mousemove",ra),b.off("mouseup",sa)),O=!1,x.el.removeClass("active"),K=L=null),u&&(c.cancel(u),u=null),(S>10||-10>S)&&(T=.8*S,V=Math.round(F+T),t=Date.now(),l(oa)),j||ka(a,!0)},ta=function(a){return N=la(a),M=E,P=!0,W=X=0,Y=E,j||(b.on("mousemove",ua),b.on("mouseup",va)),j&&!u&&(u=c(na,100)),x.el.addClass("active"),j||ka(a,!0)},ua=function(a){if(P){var b=la(a)-N,c=j?-b:parseInt(b*(D-B)/(B-I),10);return l(g(null,ia,M+c)),j||ka(a,!0)}},va=function(a){return P&&(j||(b.off("mousemove",ua),b.off("mouseup",va)),P=!1,x.el.removeClass("active"),M=N=null),u&&(c.cancel(u),u=null),(W>10||-10>W)&&(X=.8*W,Z=Math.round(E+X),t=Date.now(),l(pa)),j||ka(a,!0)},wa=function(a){var b=parseInt(G/2,10),c=a.clientX-x.barX[0].getBoundingClientRect().left-b,d=A-G,e=_(c/d,0,1);l(g(null,ha,(C-A)*e))},xa=function(a){var b=parseInt(I/2,10),c=a.clientY-x.barY[0].getBoundingClientRect().top-b,d=B-I,e=_(c/d,0,1);l(g(null,ia,(D-B)*e))},ya=function(){Q=!0},za=function(){Q=!1},Aa=function(a){var c=0,d=0,e=30;if(!(!Q||b[0].activeElement.isContentEditable||"INPUT"===b[0].activeElement.nodeName||a.altKey||a.ctrlKey||a.metaKey)){switch(a.which){case 37:c=-e;break;case 38:d=e;break;case 39:c=e;break;case 40:d=-e;break;case 33:d=B;break;case 32:case 34:d=-B;break;case 35:z&&!y?d=-D:c=B;break;case 36:z&&!y?d=D:c=-B;break;default:return}l(g(null,ia,E-d)),l(g(null,ha,F+c)),v.preventKeyEvents&&a.preventDefault()}},Ba=function(){var a=Date.now()-s;500>a?r=d(Ba,500-a):(x.el.removeClass("active"),r=null)},Ca=function(a){a=a.originalEvent||a;var b=a.deltaX*v.wheelSpeed,c=a.deltaY*v.wheelSpeed;s=Date.now(),r||(x.el.addClass("active"),r=d(Ba,500)),v.useBothWheelAxes?z&&!y?l(c?g(null,ia,E+c):g(null,ia,E+b)):y&&!z&&l(b?g(null,ha,F+b):g(null,ha,F+c)):(l(g(null,ia,E+c)),l(g(null,ha,F+b))),ka(a,!0)},Da=function(){if(v.useObserver&&m){var a={childList:!0,subtree:!0};q=new m(function(){l(ja)}),q.observe(x.content[0],a)}v.updateOnResize&&x.window.on("resize",ja),"none"!==v.scrollX&&(x.sliderX.on("click",ka),x.barX.on("click",wa),j?(x.el.on("touchstart",qa),x.el.on("touchmove",ra),x.el.on("touchend",sa)):x.sliderX.on("mousedown",qa)),"none"!==v.scrollY&&(x.sliderY.on("click",ka),x.barY.on("click",xa),j?(x.el.on("touchstart",ta),x.el.on("touchmove",ua),x.el.on("touchend",va)):x.sliderY.on("mousedown",ta)),j||x.el.on("wheel",Ca),v.useKeyboard&&!j&&(x.el.on("mouseenter",ya),x.el.on("mouseleave",za),b.on("keydown",Aa))},Ea=function(){q&&(q.disconnect(),q=null),v.updateOnResize&&x.window.off("resize",ja),x.sliderX.off("click",ka),x.barX.off("click",wa),x.sliderY.off("click",ka),x.barY.off("click",xa),j?(x.el.off("touchstart",qa),x.el.off("touchmove",ra),x.el.off("touchend",sa),x.el.off("touchstart",ta),x.el.off("touchmove",ua),x.el.off("touchend",va)):(x.sliderX.off("mousedown",qa),b.off("mousemove",ra),b.off("mouseup",sa),x.sliderY.off("mousedown",ta),b.off("mousemove",ua),b.off("mouseup",va),v.useKeyboard&&(x.el.off("mouseenter",ya),x.el.off("mouseleave",za),b.off("keydown",Aa)),x.el.off("wheel",Ca))};a.$on("content.reload",function(a,b){Ea(),d(function(){x.el=i(o.children()[0]),x.content=i(x.el.children()[0]),Da(),ja(a,b)})}),a.$on("content.changed",function(a,b,c){b=b||100,d(function(){ja(a,c)},b),a.preventDefault()}),a.$on("scrollable.scroll.left",function(){a.$applyAsync(function(){ha(0)})}),a.$on("scrollable.scroll.right",function(){a.$applyAsync(function(){ha(C)})}),a.$on("scrollable.scroll.top",function(){a.$applyAsync(function(){ia(0)})}),a.$on("scrollable.scroll.bottom",function(){a.$applyAsync(function(){ia(D)})}),a.$on("$destroy",function(){d.cancel(r),Ea()}),Da(),ja(),angular.forEach(["spyX","spyY"],function(b){p[b]&&(R[b]=f(p[b]).assign,a.$watch(p[b],function(a){switch(b){case"spyX":ha(a);break;case"spyY":ia(a)}}))})}}}]);